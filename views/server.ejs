<%- include _head.ejs -%>
    <header>
      <%- include header.ejs -%>  
    </header>
    
    <main>

      <div class="banner-container">
        <div class="row">
      
          <div class="col s2">
            <div class="body-banner center">
                <div class="avatar-banner">
                 <img class="responsive-img" src="https://cdn.discordapp.com/icons/<%=guild.id%>/<%=guild.icon%>.png">
                </div>
                
            </div>

          </div>
          <div class="col s4">
            <div class="body-banner-name">
              <span class="banner-name-server"> 
                <%= guild.name%>
              </span>
              <p class="name-owner">
               <a href="/user/<%= guild.owner.user.id %>"><%= guild.owner.user.username %>#<%= guild.owner.user.discriminator%></a> 
               
              </p>
              
            </div>
          </div>
            
          <div class="col s6">

          </div>
        </div>
        
      </div>
      <div class="container server-info">
        <div class="body-server-stats">
          <div class="row">
            <div class="col s12">
            <h2 class="h2-perfil">
              Estadisticas del servidor:
            </h2> 
              <div class="row center-align row-stats">
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Miembros
                  </p>
                    <span class="text-stats">
                         <%= guild.members.size %>
                    </span>
                 </div>

                </div>
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Canales
                  </p>
                    <span class="text-stats">
                         <%= guild.channels.size %>
                    </span>
                 </div>

                </div>
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Roles
                  </p>
                    <span class="text-stats">
                         <%= guild.roles.size %>
                    </span>
                 </div>

                </div>
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Emojis
                  </p>
                    <span class="text-stats">
                         <%= guild.emojis.size %>
                    </span>
                 </div>

                </div>
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Region
                  </p>
                    <span class="text-stats">
                         <%= guild.region %>
                    </span>
                 </div>

                </div>
                <div class="col s3">
                 <div class="box-stats z-depth-3">
                  <p>
                    Baneados
                  </p>
                    <span class="text-stats">
                      <%= bans %>
                    </span>
                 </div>

                </div>
                
                   
              </div>
            </div>

          </div>

        </div>
        <hr>
        <div class="body-server-activity">
          <div class="row">
           
            
            <div class="col s6">
              <h2>
                Actividad de miembros:
              </h2>
              <canvas id="myChart" width="400" height="400"></canvas>
              <script>
                var ctx = document.getElementById('myChart').getContext('2d');
                let chart = new Chart(ctx, {

                        type: 'line',

                        data: {

                            labels: <%- JSON.stringify(date); %>,
                            datasets: [{

                                label: 'Actividad',
                                borderColor: '#ff0000',
                                data: <%- JSON.stringify(countActivity) %>

                            }]

                        }

                    });
              </script>
            </div>
            <div class="col s6">
              <h2>
                Actividad de canales:
              </h2>
              <canvas id="myChannel" width="400" height="400"></canvas>
              <script>
                let datas = {
                      datasets: [{
                          data: <%- JSON.stringify(countChannel) %>,
                          backgroundColor: [
                              "#FF6384",
                              "#4BC0C0",
                              "#FFCE56"
                          ],
                          label: 'My dataset'
                      }],
                      labels: <%- JSON.stringify(datoChannels) %>
                  };
                var ctxc = document.getElementById('myChannel').getContext('2d');
                let charts = new Chart(ctxc, {
                                  data: datas,
                                  type: 'polarArea'
                              });
              </script>
            </div>
          </div>
        </div>
        <hr>
        <div class="body-server-info">
          <div class="row">
            <div class="col s6">
              <h2>
                Miembros estados:
              </h2>
              <ul class="collection with-header">
                <li class="collection-item">
                  <i class="material-icons secondary-content">brightness_1</i>
                  <div> Conectados: <%= guild.members.filter(m => m.presence.status === 'online').size %></div>
                  
                </li>
                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: yellow;">brightness_1</i>
                  <div> Ausentes: <%= guild.members.filter(m => m.presence.status === 'idle').size %></div>
                  
                </li>
                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: red;">brightness_1</i>
                  <div> No molestar: <%= guild.members.filter(m => m.presence.status === 'dnd').size %></div>
                  
                </li>
                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: grey;">brightness_1</i>
                  <div> Desconectados: <%= guild.members.filter(m => m.presence.status === 'offline').size %></div>
                  
                </li>
                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: #743080;">brightness_1</i>
                  <div> En directo: <%= guild.members.filter(m => m.presence.status === 'streaming').size %></div>
                  
                </li>
              </ul>

            </div>
            <div class="col s6">
              <h2 >
                Miembros:
              </h2>
              <ul class="collection with-header">

                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: #743080;">person</i>
                  <div> Usuarios: <%= guild.members.filter(m => !m.user.bot).size %></div>
                  
                </li>
                <li class="collection-item">
                  <i class="material-icons secondary-content" style="color: #743080;">adb</i>
                  <div> Bots: <%= guild.members.filter(m => m.user.bot).size %></div>
                  
                </li>
              
              </ul>
            </div>
          </div>
        </div>
        <hr>
        <section class="container-send-msg">
            <h2>
              Enviar un mensaje/anuncio:
            </h2>
            <div class="row">
              <form class="col s12" method="post" id="enviar_MSG" action="/server/<%=guild.id%>">
                <div class="row">
                  <div class="input-field col s6">
                    <i class="material-icons prefix">account_circle</i>
                    <select id="select-channel" name="channel_ID"> 
                      <option value="no_select" disabled selected>Selecciones un canal</option> 
                      <% guild.channels.filter(ch => ch.type === 'text').filter(p => p.permissionsFor(client.user).has('SEND_MESSAGES') && p.permissionsFor(client.user).has('READ_MESSAGES')).map(lc => {%>
                      <option value="<%=lc.id %>">#<%=lc.name%></option>
                      <%   
                      });
                      %>
                    </select>
                  
                  </div>
                  <div class="input-field col s6">
                    <i class="material-icons prefix">chat</i>
                    <input id="icon_prefix" type="text" name="msg_send" id="msg_input" class="validate">
                    <label for="icon_prefix">Escribe un mensaje</label>
                  </div>
                  <div class="input-field col s12">
                    <button class="btn waves-effect waves-light" type="submit" id="btn_Enviar" onClick="enviar()" name="action">Enviar
                      <i class="material-icons right">send</i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
        </section>
        <div class="row">

          <div class="col s6">
            <h1>Lista de usuarios</h1>
             <ul class="collection">

                <% guild.members.filter(u => !u.user.bot).map(member => { %>
                <li class="collection-item"><a href="/user/<%= member.user.id %>"><%= member.user.username %>#<%= member.user.discriminator%></a></li>
                <% }) %>
              </ul>
          </div>
          <div class="col s6"><h1>Lista de Canales</h1>
            <p>Texto: (<%= guild.channels.filter(x => x.type === "text").size %>)</p>
            <ul class="collection">
              <% guild.channels.filter(x => x.type === "text").map(canal => {%>
                <li class="collection-item">#<%= canal.name%></li>
             <% })%>
            </ul>
            <p>Voz: (<%= guild.channels.filter(x => x.type === "voice").size %>)</p>
            <ul class="collection">
              <% guild.channels.filter(x => x.type === "voice").map(canal => {%>
                <li class="collection-item">🎧 <%= canal.name%></li>
             <% })%>
            </ul>
          
          </div>
          
          <div class="col s6">
            <h1>Lista de roles</h1>
             <ul class="collection">
            <% guild.roles.map(rol => {%>
               <li class="collection-item">@<%= rol.name %> (<%= (rol.members.size)%>)</li>
            <% })%>
               </ul>
          </div>
          
        </div>
      </div>

    </main>
    
    <footer>
      <%- include footer.ejs -%>  
    </footer>

<%- include _footer.ejs -%>